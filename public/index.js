(()=>{"use strict";const e=function(){function e(){var e=this;this.getInputs=function(){if(e.midiAccess)return e.midiAccess.inputs;throw new Error("No MIDI access")},this.setSelectedInput=function(t){console.log(t);var n=e.getInputs().get(t);if(void 0===n&&e.setActiveInput(null),!n)throw new Error(t+" inputId doesn't match")},this.setActiveInput=function(t){e.activeInput&&(e.activeInput.onmidimessage=function(){}),e.activeInput=t||null,e.activeInput&&(e.activeInput.onmidimessage=e.onMIDIMessage)},this.onMIDIMessage=function(e){console.log(e.data)},this.onstatechange=function(t){e.activeInput&&t.port.id===e.activeInput.id&&e.setActiveInput(null),e.updateInputSelect()},this.updateInputSelect=function(){for(var t=e.midiInputSelectElem.options.length-1;t>=1;--t)e.midiInputSelectElem.options.remove(t);for(var n=0,i=Array.from(e.getInputs().values());n<i.length;n++){var o=i[n],c=document.createElement("option");o.name?c.text=o.name:c.text=o.id,c.value=o.id,e.midiInputSelectElem.add(c)}},this.midiAccess=null,this.midiInputSelectElem=null,this.activeInput=null}return e.prototype.init=function(e){return t=this,n=void 0,o=function(){var t,n;return function(e,t){var n,i,o,c,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function r(c){return function(r){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,i=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){s=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){s.label=c[1];break}if(6===c[0]&&s.label<o[1]){s.label=o[1],o=c;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(c);break}o[2]&&s.ops.pop(),s.trys.pop();continue}c=t.call(e,s)}catch(e){c=[6,e],i=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,r])}}}(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=this,[4,navigator.requestMIDIAccess()];case 1:return t.midiAccess=i.sent(),console.log("MIDI access gained"),this.midiInputSelectElem=e,this.updateInputSelect(),this.midiAccess.onstatechange=this.onstatechange,[3,3];case 2:return n=i.sent(),console.error("MIDI access rejected "+n),[3,3];case 3:return[2]}}))},new((i=void 0)||(i=Promise))((function(e,c){function s(e){try{u(o.next(e))}catch(e){c(e)}}function r(e){try{u(o.throw(e))}catch(e){c(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,r)}u((o=o.apply(t,n||[])).next())}));var t,n,i,o},e}();var t=document.getElementById("MIDI_Input_sel"),n=document.getElementById("volume"),i=new e,o=new window.AudioContext,c=new function(e){var t=this;this.noteOn=function(e){console.log(t.noteNumberToFrequency(e));var n=t.generateSound(t.noteNumberToFrequency(e));t.oscillators.set(e,n)},this.noteOff=function(e){var n=t.oscillators.get(e);void 0!==n&&n.stop(),t.oscillators.delete(e)},this.setVolume=function(e){t.masterGainNode&&(t.masterGainNode.gain.value=e)},this.generateSound=function(e){var n=t.context.createOscillator();return n.connect(t.masterGainNode),t.selectedWaveType&&(n.type=t.selectedWaveType),n.frequency.value=e,n.start(),n},this.noteNumberToFrequency=function(e){return 440*Math.pow(2,(e-69)/12)},this.context=e,this.oscillators=new Map,this.masterGainNode=this.context.createGain(),this.selectedWaveType="square"}(o);c.setVolume(Number(n.value)),window.addEventListener("click",(function e(t){o.resume().then((function(){console.log("Audio context resumed successfully")})),window.removeEventListener("click",e),c.noteOn(49)})),i.init(t),t.addEventListener("change",(function(e){i.setSelectedInput(t.value)})),n.addEventListener("change",(function(e){c.setVolume(Number(n.value))})),c.noteOn(48)})();